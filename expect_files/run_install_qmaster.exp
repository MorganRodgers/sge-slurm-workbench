#!/bin/expect -f
#
# This Expect script was generated by autoexpect on Thu Jan 10 02:14:34 2019
# Expect and autoexpect were both written by Don Libes, NIST.
#
# Note that autoexpect does not guarantee a working script.  It
# necessarily has to guess about certain things.  Two reasons a script
# might fail are:
#
# 1) timing - A surprising number of programs (rn, ksh, zsh, telnet,
# etc.) and devices discard or ignore keystrokes that arrive "too
# quickly" after prompts.  If you find your new script hanging up at
# one spot, try adding a short sleep just before the previous send.
# Setting "force_conservative" to 1 (see below) makes Expect do this
# automatically - pausing briefly before sending each character.  This
# pacifies every program I know of.  The -c flag makes the script do
# this in the first place.  The -C flag allows you to define a
# character to toggle this mode off and on.

set force_conservative 0  ;# set to 1 to force conservative mode even if
        ;# script wasn't run conservatively originally
if {$force_conservative} {
  set send_slow {1 .1}
  proc send {ignore arg} {
    sleep .1
    exp_send -s -- $arg
  }
}

#
# 2) differing output - Some programs produce different output each time
# they run.  The "date" command is an obvious example.  Another is
# ftp, if it produces throughput statistics at the end of a file
# transfer.  If this causes a problem, delete these patterns or replace
# them with wildcards.  An alternative is to use the -p flag (for
# "prompt") which makes Expect only look for the last line of output
# (i.e., the prompt).  The -P flag allows you to define a character to
# toggle this mode off and on.
#
# Read the man page for more info.
#
# -Don


set timeout -1
spawn ./install_qmaster -munge
match_max 100000
expect -exact "\[3;J\[H\[2J\r
Welcome to the Grid Engine installation\r
---------------------------------------\r
\r
Grid Engine qmaster host installation\r
-------------------------------------\r
\r
Before you continue with the installation please read these hints:\r
\r
   - Your terminal window should have a size of at least\r
     80x24 characters\r
\r
   - The INTR character is often bound to the key Ctrl-C.\r
     The term >Ctrl-C< is used during the installation if you\r
     have the possibility to abort the installation\r
\r
The qmaster installation procedure will take approximately 5-10 minutes.\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Choosing Grid Engine admin user account\r
---------------------------------------\r
\r
You may install Grid Engine so that all files are created with the user id of an\r
unprivileged user.\r
\r
This will make it possible to install and run Grid Engine in directories\r
where user >root< has no permissions to create and write files and directories.\r
\r
   - Grid Engine still has to be started by user >root<\r
\r
   - this directory should be owned by the Grid Engine administrator\r
\r
Do you want to install Grid Engine\r
under a user ID other than >root< (y/n) \[y\] >> "
send -- "n\r"
expect -exact "n\r
\r
\r
Installing Grid Engine as user >root<\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2J\r
Checking \$SGE_ROOT directory\r
----------------------------\r
\r
The Grid Engine root directory is not set!\r
Please enter a correct path for SGE_ROOT.\r
\r
If this directory is not correct (e.g. it may contain an automounter\r
prefix) enter the correct path to this directory or hit <RETURN>\r
to use default \[/opt/sge\] >> "
send -- "\r"
expect -exact "\r
Your \$SGE_ROOT directory: /opt/sge\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Grid Engine TCP/IP communication service\r
----------------------------------------\r
\r
The port for sge_qmaster is currently set as service.\r
\r
   sge_qmaster service set to port 6444\r
\r
Now you have the possibility to set/change the communication ports by using the\r
>shell environment< or you may configure it via a network service, configured\r
in local >/etc/service<, >NIS< or >NIS+<, adding an entry in the form\r
\r
    sge_qmaster <port_number>/tcp\r
\r
to your services database and make sure to use an unused port number.\r
\r
How do you want to configure the Grid Engine communication ports?\r
\r
Using the >shell environment<:                           \[1\]\r
\r
Using a network service like >/etc/service<, >NIS/NIS+<: \[2\]\r
\r
(default: 2) >> "
send -- "\r"
expect -exact "\r
\[3;J\[H\[2J\r
Grid Engine TCP/IP service >sge_qmaster<\r
----------------------------------------\r
\r
Using the service\r
\r
   sge_qmaster\r
\r
for communication with Grid Engine.\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Grid Engine TCP/IP communication service\r
----------------------------------------\r
\r
The port for sge_execd is currently set as service.\r
\r
   sge_execd service set to port 6445\r
\r
Now you have the possibility to set/change the communication ports by using the\r
>shell environment< or you may configure it via a network service, configured\r
in local >/etc/service<, >NIS< or >NIS+<, adding an entry in the form\r
\r
    sge_execd <port_number>/tcp\r
\r
to your services database and make sure to use an unused port number.\r
\r
How do you want to configure the Grid Engine communication ports?\r
\r
Using the >shell environment<:                           \[1\]\r
\r
Using a network service like >/etc/service<, >NIS/NIS+<: \[2\]\r
\r
(default: 2) >> "
send -- "\r"
expect -exact "\r
\[3;J\[H\[2J\r
Grid Engine TCP/IP communication service \r
-----------------------------------------\r
\r
Using the service\r
\r
   sge_execd\r
\r
for communication with Grid Engine.\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2J\r
Grid Engine cells\r
-----------------\r
\r
Grid Engine supports multiple cells.\r
\r
If you are not planning to run multiple Grid Engine clusters or if you don't\r
know yet what a Grid Engine cell is, it is safe to keep the default cell name\r
\r
   default\r
\r
If you want to install multiple cells you can enter a cell name now.\r
\r
The environment variable\r
\r
   \$SGE_CELL=<your_cell_name>\r
\r
will be set for all further Grid Engine commands.\r
\r
Enter cell name \[default\] >> "
send -- "\r"
expect -exact "\r
\r
Using cell >default<. \r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2J\r
Unique cluster name\r
-------------------\r
\r
The cluster name uniquely identifies a specific Sun Grid Engine cluster.\r
The cluster name must be unique throughout your organization. The name \r
is not related to the SGE cell.\r
\r
The cluster name must start with a letter (\[A-Za-z\]), followed by letters, \r
digits (\[0-9\]), dashes (-) or underscores (_).\r
\r
Enter new cluster name or hit <RETURN>\r
to use default \[p6444\] >> "
send -- "sge-cluster\r"
expect -exact "sge-cluster\r
creating directory: /opt/sge/default/common\r
\r
Your \$SGE_CLUSTER_NAME: sge-cluster\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2J\r
Grid Engine qmaster spool directory\r
-----------------------------------\r
\r
The qmaster spool directory is the place where the qmaster daemon stores\r
the configuration and the state of the queueing system.\r
\r
User >root< on this host must have read/write access to the qmaster\r
spool directory.\r
\r
If you will install shadow master hosts or if you want to be able to start\r
the qmaster daemon on other hosts (see the corresponding section in the\r
Grid Engine Installation and Administration Manual for details) the account\r
on the shadow master hosts also needs read/write access to this directory.\r
\r
Enter a qmaster spool directory \[/opt/sge/default/spool/qmaster\] >> "
send -- "\r"
expect -exact "\r
\r
Using qmaster spool directory >/opt/sge/default/spool/qmaster<. \r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2JWindows Execution Host Support\r
------------------------------\r
\r
Are you going to install Windows Execution Hosts? (y/n) \[n\] >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Verifying and setting file permissions\r
--------------------------------------\r
\r
Did you either install this version with a package manager,\r
or otherwise verify and set the file permissions of your\r
distribution (enter: y) (y/n) \[y\] >> "
send -- "\r"
expect -exact "\r
\r
We do not verify file permissions. Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2J\r
Select default Grid Engine hostname resolving method\r
----------------------------------------------------\r
\r
Are all hosts of your cluster in one DNS domain? If this is\r
the case the hostnames\r
\r
   >hostA< and >hostA.foo.com<\r
\r
would be treated as equal, because the DNS domain name >foo.com<\r
is ignored when comparing hostnames.\r
\r
Are all hosts of your cluster in a single DNS domain (y/n) \[y\] >> "
send -- "\r"
expect -exact "\r
\r
Ignoring domain name when comparing hostnames.\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2J\r
Grid Engine JMX MBean server\r
----------------------------\r
\r
In order to use the SGE Inspect or the Service Domain Manager (SDM)\r
SGE adapter you need to configure a JMX server in qmaster. Qmaster \r
will then load a Java Virtual Machine through a shared library.\r
NOTE: Java  or later is required for the JMX MBean server.\r
\r
Do you want to enable the JMX MBean server (y/n) \[n\] >> "
send -- "\r"
expect -exact "\r
\r
\r
Making directories\r
------------------\r
\r
creating directory: /opt/sge/default/spool/qmaster\r
creating directory: /opt/sge/default/spool/qmaster/job_scripts\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Setup spooling\r
--------------\r
Your SGE binaries are compiled to link the spooling libraries\r
during runtime (dynamically). So you can choose between Berkeley DB \r
spooling and Classic spooling methods.\r
Please choose a spooling method (berkeleydb|classic) \[classic\] >> "
send -- "\r"
expect -exact "\r
\[3;J\[H\[2JDumping bootstrapping information\r
Initializing spooling database\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2J\r
Grid Engine group id range\r
--------------------------\r
\r
When jobs are started under the control of Grid Engine an additional group id\r
is set on platforms which do not support jobs. This is done to provide maximum\r
control for Grid Engine jobs.\r
\r
This additional UNIX group id range must be unused group ids in your system.\r
Each job will be assigned a unique id during the time it is running.\r
Therefore you need to provide a range of ids which will be assigned\r
dynamically for jobs.\r
\r
The range must be big enough to provide enough numbers for the maximum number\r
of Grid Engine jobs running at a single moment on a single host. E.g. a range\r
like >20000-20100< means that Grid Engine will use the group ids from\r
20000-20100 and provides a range for 100 Grid Engine jobs at the same time\r
on a single host.\r
\r
You can change at any time the group id range in your cluster configuration.\r
\r
Please enter a range \[20000-20100\] >> "
send -- "\r"
expect -exact "\r
\r
Using >20000-20100< as gid range. Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2J\r
Grid Engine cluster configuration\r
---------------------------------\r
\r
Please give the basic configuration parameters of your Grid Engine\r
installation:\r
\r
   <execd_spool_dir>\r
\r
The pathname of the spool directory of the execution hosts. User >root<\r
must have the right to create this directory and to write into it.\r
\r
Default: \[/opt/sge/default/spool\] >> "
send -- "\r"
expect -exact "\r
\[3;J\[H\[2J\r
Grid Engine cluster configuration (continued)\r
---------------------------------------------\r
\r
<administrator_mail>\r
\r
The email address of the administrator to whom problem reports are sent.\r
\r
It is recommended to configure this parameter. You may use >none<\r
if you do not wish to receive administrator mail.\r
\r
Please enter an email address in the form >user@foo.com<.\r
\r
Default: \[none\] >> "
send -- "\r"
expect -exact "\r
\[3;J\[H\[2J\r
The following parameters for the cluster configuration were configured:\r
\r
   execd_spool_dir        /opt/sge/default/spool\r
   administrator_mail     none\r
\r
Do you want to change the configuration parameters (y/n) \[n\] >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Creating local configuration\r
----------------------------\r
Creating >act_qmaster< file\r
Adding default complex attributes\r
Adding default parallel environments (PE)\r
Adding SGE default usersets\r
Adding >sge_aliases< path aliases file\r
Adding >qtask< qtcsh sample default request file\r
Adding >sge_request< default submit options file\r
Creating >sgemaster< script\r
Creating >sgeexecd< script\r
Creating settings files for >.profile/.cshrc<\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
qmaster startup script\r
----------------------\r
\r
We can install the startup script that will\r
start qmaster at machine boot (y/n) \[y\] >> "
send -- "\r"
expect -exact "\r
\r
Installing startup script /etc/rc.d/rc3.d/S95sgemaster.sge-cluster and /etc/rc.d/rc3.d/K03sgemaster.sge-cluster\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Grid Engine qmaster startup\r
---------------------------\r
\r
Starting qmaster daemon. Please wait ...\r
   Starting Grid Engine qmaster\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Adding Grid Engine hosts\r
------------------------\r
\r
Please now add the list of hosts where you will later install your execution\r
daemons. These hosts will be also added as valid submit hosts.\r
\r
Please enter a blank-separated list of your execution hosts. You may\r
press <RETURN> if the line is getting too long. Once you are finished\r
simply press <RETURN> without entering a name.\r
\r
You also may prepare a file with the hostnames of the machines where you plan\r
to install Grid Engine. This may be convenient if you are installing Grid\r
Engine on many hosts.\r
\r
Do you want to use a file which contains the list of hosts (y/n) \[n\] >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Adding admin and submit hosts\r
-----------------------------\r
\r
Please enter a blank-separated list of hosts.\r
\r
Stop by entering <RETURN>. You may repeat this step until you are\r
entering an empty list. You will see messages from Grid Engine\r
when the hosts are added.\r
\r
Host(s): "
send -- "ood head\r"
expect -regexp "ood head\r
.*\r
.*\r
.*\r
.*\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Adding admin and submit hosts\r
-----------------------------\r
\r
Please enter a blank-separated list of hosts.\r
\r
Stop by entering <RETURN>. You may repeat this step until you are\r
entering an empty list. You will see messages from Grid Engine\r
when the hosts are added.\r
\r
Host(s): "
send -- "\r"
expect -exact "\r
Finished adding hosts. Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
If you want to use a shadow host, it is recommended to add this host\r
to the list of administrative hosts.\r
\r
If you are not sure, it is also possible to add or remove hosts after the\r
installation with <qconf -ah hostname> for adding and <qconf -dh hostname>\r
for removing this host\r
\r
Attention: This is not the shadow host installation\r
procedure.\r
You still have to install the shadow host separately\r
\r
Do you want to add your shadow host(s) now? (y/n) \[n\] >> "
send -- "\r"
expect -regexp "\r
\r
.*\r
Creating the default <all.q> queue and <allhosts> hostgroup\r
-----------------------------------------------------------\r
\r
root@.* added \"@allhosts\" to host group list\r
root@.* added \"all.q\" to cluster queue list\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2JScheduler Tuning\r
----------------\r
\r
The details on the different options are described in the manual. \r
\r
Configurations\r
--------------\r
1) Normal\r
          Fixed interval scheduling, report limited scheduling information,\r
          actual + assumed load\r
\r
2) High\r
          Fixed interval scheduling, report limited scheduling information,\r
          actual load\r
\r
3) Max\r
          Immediate Scheduling, report no scheduling information,\r
          actual load\r
\r
Enter the number of your preferred configuration and hit <RETURN>! \r
Default configuration is \[1\] >> "
send -- "\r"
expect -exact "\r
\r
We're configuring the scheduler with >Normal< settings!\r
Do you agree? (y/n) \[y\] >> "
send -- "\r"
expect -exact "\r
\r
changed scheduler configuration\r
\[3;J\[H\[2J\[3;J\[H\[2J\[3;J\[H\[2J\r
Using Grid Engine\r
-----------------\r
\r
You should now enter the command:\r
\r
   source /opt/sge/default/common/settings.csh\r
\r
if you are a csh/tcsh user or\r
\r
   # . /opt/sge/default/common/settings.sh\r
\r
if you are a sh/bash/ksh user.\r
\r
This will set or expand the following environment variables:\r
\r
   - \$SGE_ROOT         (always necessary)\r
   - \$SGE_CELL         (if you are using a cell other than >default<)\r
   - \$SGE_CLUSTER_NAME (always necessary)\r
   - \$SGE_QMASTER_PORT (if you haven't added the service >sge_qmaster<)\r
   - \$SGE_EXECD_PORT   (if you haven't added the service >sge_execd<)\r
   - \$PATH/\$path       (to find the Grid Engine binaries)\r
   - \$MANPATH          (to access the manual pages)\r
Alternatively use module(1) after installing /opt/sge/default/common/sge.module\r
\r
\r
Since -munge was specified, you need to set up the MUNGE daemon\r
on all nodes\r
\r
Hit <RETURN> to see where Grid Engine logs messages >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Grid Engine messages\r
--------------------\r
\r
Grid Engine messages can be found in syslog during startup:\r
\r
After startup the daemons log their messages in their spool directories.\r
\r
   Qmaster:     /opt/sge/default/spool/qmaster/messages\r
   Exec daemon: <execd_spool_dir>/<hostname>/messages\r
or in syslog, if configured\r
\r
\r
Grid Engine startup scripts\r
---------------------------\r
\r
Grid Engine startup scripts can be found at:\r
\r
   /opt/sge/default/common/sgemaster (qmaster)\r
   /opt/sge/default/common/sgeexecd (execd)\r
\r
Do you want to see previous screen about using Grid Engine again (y/n) \[n\] >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Your Grid Engine qmaster installation is now completed\r
------------------------------------------------------\r
\r
Please now login to all hosts where you want to run an execution daemon\r
and start the execution host installation procedure.\r
\r
If you want to run an execution daemon on this host, please do not forget\r
to make the execution host installation in this host as well.\r
\r
All execution hosts must be administrative hosts during the installation.\r
All hosts which you added to the list of administrative hosts during this\r
installation procedure can now be installed.\r
\r
You may verify your administrative hosts with the command\r
\r
   # qconf -sh\r
\r
and you may add new administrative hosts with the command\r
\r
   # qconf -ah <hostname>\r
\r
Please hit <RETURN> >> "
send -- "\r"
expect eof
