#!/bin/expect -f
#
# This Expect script was generated by autoexpect on Fri Jan 11 01:11:04 2019
# Expect and autoexpect were both written by Don Libes, NIST.
#
# Note that autoexpect does not guarantee a working script.  It
# necessarily has to guess about certain things.  Two reasons a script
# might fail are:
#
# 1) timing - A surprising number of programs (rn, ksh, zsh, telnet,
# etc.) and devices discard or ignore keystrokes that arrive "too
# quickly" after prompts.  If you find your new script hanging up at
# one spot, try adding a short sleep just before the previous send.
# Setting "force_conservative" to 1 (see below) makes Expect do this
# automatically - pausing briefly before sending each character.  This
# pacifies every program I know of.  The -c flag makes the script do
# this in the first place.  The -C flag allows you to define a
# character to toggle this mode off and on.

set force_conservative 0  ;# set to 1 to force conservative mode even if
			  ;# script wasn't run conservatively originally
if {$force_conservative} {
	set send_slow {1 .1}
	proc send {ignore arg} {
		sleep .1
		exp_send -s -- $arg
	}
}

#
# 2) differing output - Some programs produce different output each time
# they run.  The "date" command is an obvious example.  Another is
# ftp, if it produces throughput statistics at the end of a file
# transfer.  If this causes a problem, delete these patterns or replace
# them with wildcards.  An alternative is to use the -p flag (for
# "prompt") which makes Expect only look for the last line of output
# (i.e., the prompt).  The -P flag allows you to define a character to
# toggle this mode off and on.
#
# Read the man page for more info.
#
# -Don


set timeout -1
spawn ./install_execd -munge
match_max 100000
expect -exact "\[3;J\[H\[2J\r
Welcome to the Grid Engine execution host installation\r
------------------------------------------------------\r
\r
If you haven't installed the Grid Engine qmaster host yet, you must execute\r
this step (with >install_qmaster<) prior the execution host installation.\r
\r
For a successful installation you need a running Grid Engine qmaster. It is\r
also necessary that this host is an administrative host.\r
\r
You can verify your current list of administrative hosts with\r
the command:\r
\r
   # qconf -sh\r
\r
You can add an administrative host with the command:\r
\r
   # qconf -ah <hostname>\r
\r
The execution host installation will take approximately 5 minutes.\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2J\r
Checking \$SGE_ROOT directory\r
----------------------------\r
\r
The Grid Engine root directory is:\r
\r
   \$SGE_ROOT = /opt/sge\r
\r
If this directory is not correct (e.g. it may contain an automounter\r
prefix) enter the correct path to this directory or hit <RETURN>\r
to use default \[/opt/sge\] >> "
send -- "\r"
expect -exact "\r
\r
Your \$SGE_ROOT directory: /opt/sge\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2J\r
Grid Engine cells\r
-----------------\r
\r
Please enter the cell name which you used for the qmaster\r
installation or press <RETURN> to use \[default\] >> "
send -- "\r"
expect -exact "\r
\r
Using cell: >default<\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2J\[3;J\[H\[2J\r
Grid Engine TCP/IP communication service\r
----------------------------------------\r
\r
The port for sge_execd is currently set as service.\r
\r
   sge_execd service set to port 6445\r
\r
Hit <RETURN> to continue >>"
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Checking hostname resolving\r
---------------------------\r
\r
This hostname is known at qmaster as an administrative host.\r
\r
Hit <RETURN> to continue >>"
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Execd spool directory configuration\r
-----------------------------------\r
\r
You defined a global spool directory when you installed the master host.\r
You can use that directory for spooling jobs from this execution host\r
or you can define a different spool directory for this execution host.\r
\r
ATTENTION: For most operating systems, the spool directory does not have to\r
be located on a local disk. The spool directory can be located on a \r
network filesystem. However, using a local spool directory provides \r
better performance.\r
\r
FOR WINDOWS USERS: On Windows systems, the spool directory MUST be located\r
on a local disk. If you install an execution daemon on a Windows system\r
without a local spool directory, the execution host is unusable.\r
\r
The spool directory is currently set to:\r
<</opt/sge/default/spool/ood>>\r
\r
Do you want to configure a different spool directory\r
for this host (y/n) \[n\] >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Creating local configuration\r
----------------------------\r
root@ood modified \"ood\" in configuration list\r
Local configuration for host >ood< created.\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
execd startup script\r
--------------------\r
\r
We can install the startup script that will\r
start execd at machine boot (y/n) \[y\] >> "
send -- "\r"
expect -exact "\r
\r
Installing startup script /etc/rc.d/rc3.d/S96sgeexecd.sge-cluster and /etc/rc.d/rc3.d/K02sgeexecd.sge-cluster\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Grid Engine execution daemon startup\r
------------------------------------\r
\r
Starting execution daemon. Please wait ...\r
   Starting Grid Engine execution daemon\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Adding a queue for this host\r
----------------------------\r
\r
We can now add a queue instance for this host:\r
\r
   - it is added to the >allhosts< hostgroup\r
   - the queue provides 1 slot(s) for jobs in all queues\r
     referencing the >allhosts< hostgroup\r
\r
You do not need to add this host now, but before running jobs on this host\r
it must be added to at least one queue.\r
\r
Do you want to add a default queue instance for this host (y/n) \[y\] >> "
send -- "\r"
expect -exact "\r
\r
root@ood modified \"@allhosts\" in host group list\r
root@ood modified \"all.q\" in cluster queue list\r
\r
Hit <RETURN> to continue >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\[3;J\[H\[2J\[3;J\[H\[2J\r
Using Grid Engine\r
-----------------\r
\r
You should now enter the command:\r
\r
   source /opt/sge/default/common/settings.csh\r
\r
if you are a csh/tcsh user or\r
\r
   # . /opt/sge/default/common/settings.sh\r
\r
if you are a sh/bash/ksh user.\r
\r
This will set or expand the following environment variables:\r
\r
   - \$SGE_ROOT         (always necessary)\r
   - \$SGE_CELL         (if you are using a cell other than >default<)\r
   - \$SGE_CLUSTER_NAME (always necessary)\r
   - \$SGE_QMASTER_PORT (if you haven't added the service >sge_qmaster<)\r
   - \$SGE_EXECD_PORT   (if you haven't added the service >sge_execd<)\r
   - \$PATH/\$path       (to find the Grid Engine binaries)\r
   - \$MANPATH          (to access the manual pages)\r
Alternatively use module(1) after installing /opt/sge/default/common/sge.module\r
\r
\r
Since -munge was specified, you need to set up the MUNGE daemon\r
on all nodes\r
\r
Hit <RETURN> to see where Grid Engine logs messages >> "
send -- "\r"
expect -exact "\r
\r
\[3;J\[H\[2J\r
Grid Engine messages\r
--------------------\r
\r
Grid Engine messages can be found in syslog during startup:\r
\r
After startup the daemons log their messages in their spool directories.\r
\r
   Qmaster:     /opt/sge/default/spool/qmaster/messages\r
   Exec daemon: <execd_spool_dir>/<hostname>/messages\r
or in syslog, if configured\r
\r
\r
Grid Engine startup scripts\r
---------------------------\r
\r
Grid Engine startup scripts can be found at:\r
\r
   /opt/sge/default/common/sgemaster (qmaster)\r
   /opt/sge/default/common/sgeexecd (execd)\r
\r
Do you want to see previous screen about using Grid Engine again (y/n) \[n\] >> "
send -- "\r"
expect eof
